---
biblio-style: jabes
bibliography: lazbibreg.bib
documentclass: report
fontsize: 12pt
geometry: margin=1in
header-includes: \usepackage{mdwlist} \usepackage[compact]{titlesec} \usepackage{titling}
  \usepackage[font=small,labelfont=bf,tableposition=top]{caption} \usepackage{float}
  \floatstyle{plaintop} \restylefloat{table} \usepackage{lastpage} \usepackage{hyperref}
  \usepackage{colortbl} \usepackage{array} \hypersetup{backref,colorlinks=true} \usepackage{framed,color}
  \definecolor{shadecolor}{rgb}{0.95, 0.92, 0.88} \usepackage{graphicx} \usepackage{booktabs}
  \usepackage{fancyhdr} \usepackage[none]{hyphenat} \raggedright \usepackage{amsmath,
  amsthm, amssymb, bm} \usepackage{marginnote} \usepackage{subfig} \def\mygraphcaption{Here
  are my graphs.} \newlength{\mygraphwidth}\setlength{\mygraphwidth}{0.9\textwidth}
  \usepackage{listings}
output:
  pdf_document:
    citation_package: natbib
    fig_caption: yes
    highlight: tango
  html_document:
    df_print: paged
subparagraph: yes
---
  \lstset{
	basicstyle=\small\ttfamily,
	columns=flexible,
	breaklines=true}
	
  \pagestyle{fancy}
  \fancyhead[L]{\textbf{Don, Mel, Madhumithra}}
  \fancyhead[C]{}
  \fancyhead[R]{\textbf{STAT 823 Project}}
  \fancyfoot[L]{}
  \fancyfoot[C]{}
  \fancyfoot[R]{Page -\thepage- of \pageref{LastPage}}
  \fancypagestyle{plain}{\pagestyle{fancy}}
  \renewcommand{\headrulewidth}{2pt}
  \renewcommand{\footrulewidth}{2pt}
 
 \hypersetup{
	colorlinks   = true,
	citecolor    = blue,
	linkcolor    = black,
	urlcolor     = blue
  }
  
  \begin{titlepage}
   \begin{center}
       \vspace*{2cm}
        
       \vspace{0.5cm}
 
       \textbf{\textit{\LARGE Studying factors associated with prostate-specific antigen (PSA) levels in prostate cancer patients }}
 
       \vspace{0.5cm}
      
       \textbf{\Large STAT 823: Spring Class Project, 2021} 
       
        \vspace{0.5cm}
        
         \textbf{\large Don Ghysels, Melanie Valdez, Madhumithra Subramanian Karthikes}
        
       \vfill
 
       \vspace{0.7cm}
 
       \includegraphics[width=0.4\textwidth]{figures/ku}
 
       \large Department of Biostatistics and Data Science \\
       University of Kansas, USA \\
       `r format(Sys.time(), '%B %e, %Y')`
 
   \end{center}
\end{titlepage}

```{r setup, include=FALSE}
# load packages
library(knitr)
library(formatR)
library(stargazer)
library(xtable)
library(readxl)
library(ggplot2)
library(ggcorrplot)
library(gridExtra)
library(leaps)
library(car)
knitr::opts_chunk$set(echo = TRUE)
options(digits = 5, width = 60, xtable.comment = FALSE)#,knitr.table.format="latex")
opts_chunk$set(tidy.opts = list(width.cutoff=60), tidy=TRUE)
out_type <- knitr::opts_knit$get("rmarkdown.pandoc.to")
```

 \setlength{\headheight}{45pt}
 
\thispagestyle{empty}
\newpage
\pagenumbering{roman}
\setcounter{page}{1}
\pagestyle{plain}
\tableofcontents
\cleardoublepage
\phantomsection
\listoftables
\phantomsection
\listoffigures
\newpage
\pagenumbering{arabic}

\section{Abstract}
Put your abstract here

\newpage

\section{Introduction}
Put all your introduction about the study topic here and cite some references. For example,  The textbook ``\textbf{Design and Analysis of Experiments}'' by \citet{voss} is required. Additional materials that you may wish to consult include \citet{casella}, \citet{kuehl} and \citet{shalabh}.

\subsection{Primary Analysis Objectives}

Determine the association between \textit{ Serum Prostate-specific antigen level (mg/ml) \textbf{(PSA)}} and other clinical measurements in men with advanced prostate cancer

\subsection{Secondary Analysis Objectives}

Summarize patient demographic and baseline clinical characteristics

Patients experiencing end-stage renal disease (ESRD) often require a kidney transplant as it prolongs survival, decreases morbidity, and improves quality of life.  Given that over 100,000 patients are awaiting kidney transplantation, it is desirable to find ways for patients to decrease their waiting time in hopes of obtaining a transplant sooner.  A growing number of patients with ESRD have developed antibodies against human leukocyte antigens (HLAs), limiting their options for finding a reliable matching donor.  Having a treatment that reduces HLAs could have a profound impact for patients experiencing ESRD.  Study ABCD is an open-label trial exploratory study investigating the effect of compound XYZ in patients with ESRD and calculated panel reactive antibodies (cPRAs) greater than 50 percent.  

\section{Materials and Methods}
\subsection{Data Sources}
The dataset was obtained from one of the published datasets by \citet{kutner} [Here are the book's datasets](http://users.stat.ufl.edu/~rrandles/sta4210/Rclassnotes/data/textdatasets/index.html). Describe more about the data set, its variables and why you selected it.

The data available for inclusion in the covariates include 5 continuous variables and 2 categorical variables. The 5 continuous variables included \textit{Estimate of prostate cancer volume (cc) \textbf(VOL)}, \textit{Prostate weight(gm) \textbf{(WT)}}, \textit{Age of patient (years) \textbf(AGE)}, \textit{Amount of benign prostatic hyperplasia ($cm^{2}$) \textbf{HYP}}, \textbf{Degree of capsular penetration(cm) \textbf{CAP}}.  The 2 categorical variables include \textit{Seminal Vesical Invasion \textbf{SEM}}, \textit{Cleason Score \textbf{SCORE}}


\subsection{Statistical Analysis}

Describe the statistical model or models used

\subsubsection{Model Assumptions}

All inferences are conducted using $\alpha = 0.05$ unless stated otherwise.  No adjustments for multiplicity are made as this is an exploratory analysis. Discrete variables are summarized with proportions and frequencies.  Continuous variables are summarized using the following statistics:

\subsubsection{Primary Objective Analysis}

The primary objective analysis uses a Wilcoxon signed rank test to determine if there is a significant difference between cPRA scores at baseline and at week 16.  

\subsubsection{Secondary Objective Analyses}

Summary statistics are produced for baseline characteristics.  

\subsubsection{Goodness of Fit Test}

Describe here what goodness of fit statistics were used or will be used.

All of the statistical analyses in this document will be performed using `r R.version.string` [R](https://www.r-project.org/) \citep{r2018}.
R packages used will be maintained using the [packrat](http://rstudio.github.io/packrat/) dependency management system. 


```{r echo=FALSE, message=FALSE}
dataraw <- read_xlsx("../823data/pcancer.xlsx")

data2 <- data.frame(dataraw)
data2$seminal <- factor(dataraw$seminal)
levels(data2$seminal) <- c("absence", "presence")
data2$score <- factor(dataraw$score)
levels(data2$score) <- c("6", "7", "8")

attach(data2)
```
\section{Results}

Describe your results here. Add subheadings if necessary.

\subsection{summary of statistics}

```{r echo=FALSE, message=FALSE}
library(epiDisplay)
knitr::kable(summ(data2[2:9]),caption = "Summary of statistics")
```

\subsection{Analysis of Covariates}



```{r correlation, echo=FALSE, include=TRUE, message=FALSE, warning=TRUE, fig.cap="Correlation of available continuous covariates", fig.pos="H", fig.align='center', out.width="0.6\\linewidth"}
library(psych)
library(GGally)
#pairs.panels(data2[c(2:6,8)])

ggpairs(data2[c(2:6,8)],ggplot2::aes())
```

Correlation coefficients in Figure \ref{fig:correlation} indicate the best relationships are between psa and capsular and between psa and cancer volume 

The correlation between weight, hyperplasia and age were considered to weak for further exploration. 

```{r dist.cov.box, echo=FALSE, include=TRUE, fig.cap="Distribution of continuous variables",fig.pos="H", fig.align='center', out.width="0.6\\linewidth"}
p1 <- ggplot(data2, aes(y=cancerv,x=1)) + 
  geom_boxplot() + 
  geom_jitter(position=position_jitter(0.05))
p2 <- ggplot(data2, aes(y=log(cancerv),x=1), title="Cancer Volume") + 
  geom_boxplot() + 
  geom_jitter(position=position_jitter(0.05))
p3 <- ggplot(data2, aes(y=capsular,x=1), title="Cancer Volume") + 
  geom_boxplot()+ 
  geom_jitter(position=position_jitter(0.05))
p3 <- ggplot(data2, aes(y=capsular,x=1), title="Cancer Volume") + 
  geom_boxplot()+ 
  geom_jitter(position=position_jitter(0.05))
p3 <- ggplot(data2, aes(y=capsular,x=1), title="Cancer Volume") + 
  geom_boxplot()+ 
  geom_jitter(position=position_jitter(0.05))
grid.arrange(ncol = 2, p1,p2,p3)
```

Figure \ref{fig:dist.cov.box} plots the distribution for all continuous variables being considered as potential covariates.  The plots show the distribution is noticibly skewed in each case

```{r}

```


\subsection{visualize factors}

Figure \ref{fig:dist.cat} shows the distribution of the of Score and Seminal factors
```{r dist.cat, echo=FALSE, include=TRUE, fig.cap="distribution of factor variables",fig.pos="H", fig.align='center', out.width="0.6\\linewidth"}
par(mfrow = c(1,2))
tab1(data2$seminal, main = "Distribution of Seminal")
tab1(data2$score, main="Distribution of Score")
```



```{r dist.cov.hist, echo=FALSE, message=FALSE, warning=TRUE, fig.cap="Histogram of cancerv, capsular and hyperplasia"}
#par(mfrow=c(2,2))
p1 <- ggplot(data2, aes(x=cancerv)) + 
  geom_histogram(binwidth = 2)
p2 <- ggplot(data2, aes(x=log(cancerv))) + 
  geom_histogram(binwidth = 1)
p3 <- ggplot(data2, aes(x=capsular)) + 
  geom_histogram(binwidth = 0.5)
grid.arrange(ncol = 2, p1,p2,p3)
```

Figure \ref{fig:dist.cov.hist} shows the skewness of the three potential covariates, indicating the data may not be normally distributed and problems with non constant variance may exist.  A log transformation improved the distribution of Cancer Volume. Capsular does not allow for a similar transformation because of the observations with a value of '0'


```{r, echo=FALSE}
lm.cancerv <- lm(data = data2, psa ~ cancerv)
lm.cancerv.log <- lm(data = data2, log(psa) ~ log(cancerv))
lm.capsular <- lm(data = data2, log(psa) ~ (capsular))
```

```{r capsular.dist, echo=FALSE, fig.cap="Visualize Capsular distribution", message=FALSE,fig.pos="H", fig.align='center', out.width="0.6\\linewidth"}

summary(lm.capsular)
par(mfrow=c(1,2))
plot(y=data2$psa,x=data2$capsular, 
     xlab="PSA", 
     ylab="Capsular", 
     main="Capsular Regression Fit")
abline(lm.capsular)

plot(fitted(lm.capsular),residuals(lm.capsular), 
     xlab="residuals",
     ylab="fitted",
     main = "Cancer Volume fitted \n vs residuals")
abline(h = 0)
```

the fitted line in Figure \ref{fig:capsular.dist} indicates a poor linear relationship between PSA and Capsular.  The figure also shows indications the residuals will not support the non constant variance assumptions required for inference

```{r cancerv.dist, echo=FALSE, fig.cap="Visualize cancer volume distribution", message=FALSE,fig.pos="H", fig.align='center', out.width="0.6\\linewidth"}
summary(lm.cancerv)
par(mfrow=c(1,2))
plot(y=data2$psa,x=data2$cancerv, 
     xlab="PSA", 
     ylab="Cancer Volume", 
     main="Cancer Volume Regression Fit")
abline(lm.cancerv)

plot(fitted(lm.cancerv),residuals(lm.cancerv), 
     xlab="residuals",
     ylab="fitted",
     main = "Cancer Volume fitted vs residuals")
abline(h = 0)

```

Figure \ref{fig:cancerv.dist} Shows very clear evidence of distribution problems.  The non constant variance test and shapiro-wilks test both indicate the data violates the assumption of constant variance and normal distribution


```{r echo=FALSE}
ncvp <-ncvTest(lm.cancerv)$p
swp <- shapiro.test(residuals(lm.cancerv))$p.value
```

The non-constant variance test and shapiro wilks test both indicate a problem with the distribution of the residuals.  The Shapiro-wilks p-value is `r swp` and the non-constant variance test p-value is `r ncvp` indicating the residuals are not normally distributed and the non-constant varaiance assumptions must be rejected. 

\subsection{Cancer Volume transformation}

A log transformation of both psa and cancerv was found to generate a normal distribution of the residuals and also removed the problems with homoscedacity.

The regression plot and plot of the residuals vs. the fitted variables both indicate improvements in the distribution of the data

The p.values for shapiro wilks test and non-constant variance tests allow acceptance of the null hypothesis 

```{r log.cancerv.dist, echo=FALSE, include=TRUE, fig.cap="cancer volume distribution after a log log transformation",fig.pos="H", fig.align='center', out.width="0.6\\linewidth"}

par(mfrow=c(1,2))
summary(lm.cancerv.log)
plot(y=log(data2$psa),x=log(data2$cancerv), 
     xlab="log(PSA)", 
     ylab="log(Cancer Volume)", 
     main="Cancer Volume \n Regression Fit")

abline(lm.cancerv.log)

plot(fitted(lm.cancerv.log),residuals(lm.cancerv.log), 
     xlab="residuals",
     ylab="fitted",
     main = "Log(Cancer Vol.)\n fitted vs residuals")
abline(h = 0)
```

```{r tab4, results="asis",echo=FALSE, include=TRUE, message=TRUE}
ncvp <-ncvTest(lm.cancerv.log)$p
swp <- shapiro.test(residuals(lm.cancerv.log))$p.value
t<- data.frame(a=c(swp),b=c(ncvp))
knitr::kable(t,col.names =c("Shapiro-wilks p-value","ncv test p-value"),label="tab:tab4",caption = "Shapiro-wilks and ncv test")
```

\section{Compare Covariates}

```{r echo=FALSE, results = 'asis'}
b <- regsubsets(log(psa) ~ log(cancerv)+seminal+capsular+score, data = data2)
rs <- summary(b)
t <- data.frame(with(rs, cbind(which, rss, adjr2, cp, bic)), digits = 4) 
colnames(t) <- c("Intercept","Cancer Vol","Seminal","Capsular","Score8","RSS","AdjR2","cp","BIC")
knitr::kable(t[,2:9])
```

\section{test variables} 

Based on cp, bic and $R^{2}$ results, analysis will be focused on the following 3 covariates: 

\begin{itemize}
  \item Cancer Volume
  \item Gleason Score
  \item Seminal Vesicle Invasion
\end{itemize}

test for linearity and variance for each variable
\ subsection{regression models}


```{r}

```

